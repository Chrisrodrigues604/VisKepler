<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.css" rel="stylesheet">
  <link href="https://d1a3f4spazzrp4.cloudfront.net/kepler.gl/uber-fonts/4.0.0/superfine.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: ff-clan-web-pro, 'Helvetica Neue', Helvetica, sans-serif;
      background-color: #112330;
    }

    .container {
      display: flex;
      height: 100%;
    }

    .sidebar {
      width: 20%;
      background: #29323C;
      padding: 0.5rem;
      overflow-y: auto;
      position: relative;
      transition: width 0.3s ease;
    }

    .map-container {
      flex-grow: 1;
    }

    .map-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    ul {
      padding: 0;
      list-style: none;
      margin-top: 0;
    }

    li a {
      text-decoration: none;
      color: #D8D9DB;
      display: flex;
      align-items: center;
      padding: 10px;
      transition: background-color 0.3s;
      font-family: ff-clan-web-pro, 'Helvetica Neue', Helvetica, sans-serif;
      /* Added to match Layers font */
    }

    li a:hover {
      background-color: #34495e;
    }

    .fa {
      margin-right: 8px;
    }

    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
    }

    .title {
      font-family: ff-clan-web-pro, 'Helvetica Neue', Helvetica, sans-serif;
      /* Added to match Kepler.gl title font */
      color: #1FBAD6;
      font-size: 0.85em;
      letter-spacing: 0.05em;
      font-weight: 700;
    }

    .toggle-btn {
      background: none;
      border: none;
      color: #D8D9DB;
      font-size: 24px;
      cursor: pointer;
    }

    .link-text {
      display: block;
      /* default visible */
    }

    .sidebar.collapsed .link-text {
      display: none;
      /* hide text when sidebar is collapsed */
    }

    .divider {
      border-bottom: 1px solid #34495e;
      margin: 10px;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      justify-content: center;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      font-family: 'Raleway', sans-serif;
      background-color: #112330;
      border-radius: 5%;
      padding: 20px;
      color: white;
      width: auto;
      max-width: 600px;
      max-height: 80%;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #1FBAD6 #112330;
    }

    .modal-content::-webkit-scrollbar {
      width: 8px;
    }

    .modal-content::-webkit-scrollbar-thumb {
      background-color: #1FBAD6;
      border-radius: 10px;
      border: 2px solid #112330;
    }

    .modal-content::-webkit-scrollbar-track {
      background: #112330;
      border-radius: 10px;
    }

    .close-btn {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close-btn:hover,
    .close-btn:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .modal-content ul {
      list-style-type: disc;
      margin-left: 20px;
    }
    
    .modal-content li {
      margin-bottom: 10px;
    }

    #aboutModal .modal-content {
      background-image: url('/public/images/Banner.png');
      background-size: cover;
      background-position: center;
      color: rgb(0, 20, 77);
      background-repeat: no-repeat;
    }

  </style>
</head>

<body>
  <div class="container">
    <div class="sidebar" id="sidebar">
      <div class="title-bar">
        <strong class="title link-text" id="site-title">DSS-LAB</strong>
        <button class="toggle-btn" onclick="toggleSidebar()">
          <i class="fas fa-bars"></i> <!-- Hamburger Icon -->
        </button>
      </div>
      <ul id="sidebar-links">
        <!-- Links will be populated here by JavaScript -->
      </ul>
    </div>
    <div class="map-container">
      <iframe id="mapFrame" src="" class="map-iframe"></iframe>
    </div>
  </div>

  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
        <p id="modal-text">
        </p>
      </div>
  </div>

  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('aboutModal')">&times;</span>
      <p id="about-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </div>
  </div>

  <script>
    function changeMap(url) {
      document.getElementById('mapFrame').src = url;
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar.style.width === '5%') {
        sidebar.style.width = '20%';
        sidebar.classList.remove('collapsed');
      } else {
        sidebar.style.width = '5%';
        sidebar.classList.add('collapsed');
      }
    }

    async function fetchConfig() {
      try {
        const response = await fetch('/get_config');
        const data = await response.json();
        document.getElementById('site-title').innerText = data.siteTitle;
        document.getElementById('modal-text').innerText = data.about;    
        const sidebarLinks = document.getElementById('sidebar-links');
 
        if (data.maps.length > 0) {
          // Set the first map to load by default
          changeMap(data.maps[0].link);
        }
    
        data.maps.forEach(map => {
          const listItem = document.createElement('li');
          const link = document.createElement('a');
          link.href = '#';
          link.onclick = () => changeMap(map.link);
          link.innerHTML = `<i class="fa fa-map"></i><span class="link-text">${map.label}</span>`;
          listItem.appendChild(link);
          sidebarLinks.appendChild(listItem);
        });
    
        const divider = document.createElement('li');
        divider.className = 'divider';
        sidebarLinks.appendChild(divider);
    
        const infoItem = document.createElement('li');
        const infoLink = document.createElement('a');
        infoLink.href = '#';
        infoLink.onclick = () => showModal('infoModal');
        infoLink.innerHTML = '<i class="fa fa-circle-info"></i><span class="link-text">Info</span>';
        infoItem.appendChild(infoLink);
        sidebarLinks.appendChild(infoItem);

        const aboutItem = document.createElement('li');
        const aboutLink = document.createElement('a');
        aboutLink.href = '#';
        aboutLink.onclick = () => showModal('aboutModal');
        aboutLink.innerHTML = '<i class="fa fa-circle-info"></i><span class="link-text">About</span>';
        aboutItem.appendChild(aboutLink);
        sidebarLinks.appendChild(aboutItem);

      } catch (error) {
        console.error('Error fetching config:', error);
      }
    }    

    function showInfo() {
      const modal = document.getElementById('infoModal');
      modal.style.display = 'flex';
    }

    function closeModal() {
      const modal = document.getElementById('infoModal');
      modal.style.display = 'none';
    }

    //function showInfo() { 
    //  alert('Information about the maps will be shown here.');
    //}

    document.addEventListener('DOMContentLoaded', fetchConfig);

    window.onclick = function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
    })}

  </script>
</body>

</html>